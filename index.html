<div id="camera_div" class="camera" style="border-style:solid;border-color:blue; width:100%; height:100%; place-items: center;">

  <video id="video">

  </video>

</div>
<div id="button_div" style="text-align:center;">
<button id="startbutton" style="margin: auto;";>Take photo</button>
</div>
<div id="output_div" style="text-align:center; margin:auto;">
<canvas id="canvas" style="text-align:center;"> </canvas>
</div>
<!-- 
<div class="output" style="text-align:center;">
  <img id="photo" alt="The screen capture will appear in this box." style="margin:auto;"/>
</div>
 -->

<script>
//<link rel="stylesheet" href="style_cam.css">



const width = 300;    // We will scale the photo width to this
const height = 300;     // This will be computed based on the input stream

const streaming = false;

let video = document.getElementById('video');
var win_w = window.innerWidth;
var win_h = window.innerHeight;
var ratio = Math.floor((1-(win_w/win_h)*0.5)*100*0.5) + "%";
video.style.width = "50%";
video.style.aspectRatio = "1/1";
video.style.objectFit = "cover";
video.style.position = "absolute";
video.style.setProperty("top", ratio);
video.style.left = "25%";
video.style.outline = "solid";

let canvas = document.getElementById('canvas');
let photo = document.getElementById('photo');
let startbutton = document.getElementById('startbutton');

let boundbox = document.createElement("div");
ratio = Math.floor((1-(win_w/win_h)*0.2)*100*0.5) + "%";
boundbox.style.width = "20%";
boundbox.style.aspectRatio = "1/1";
boundbox.style.outline = "5px dashed green";
//boundbox.style.borderColor = "red";
// boundbox.style.zIndex = "1";
boundbox.style.position = "absolute";
boundbox.style.setProperty("top", ratio);
boundbox.style.left = "40%";


navigator.mediaDevices
  .getUserMedia({ video: {facingMode: 'environment'}, audio: false })
  .then((stream) => {
    video.srcObject = stream;
    video.play();
    document.getElementById("video").after(boundbox);
  })
  .catch((err) => {
    console.error(`An error occurred: ${err}`);
  });
  
// video.addEventListener(
//   "canplay",
//   (ev) => {
//     if (!streaming) {
//       height = (video.videoHeight / video.videoWidth) * width;
// 
//       video.setAttribute("width", width);
//       video.setAttribute("height", height);
//       canvas.setAttribute("width", width);
//       canvas.setAttribute("height", height);
//       streaming = true;
//     }
//   },
//   false
// );


startbutton.addEventListener(
  "click",
  (ev) => {
    takepicture();
    ev.preventDefault();
  },
  false
);

function takepicture() {
  const context = canvas.getContext("2d");
  if (width && height) {

    let h = video.videoHeight;
	let w = video.videoWidth;
	let h_b = boundbox.offsetHeight;
	let w_b = boundbox.offsetWidth;

	let w_crop = Math.floor(2*w*0.4);
	let h_crop = Math.floor(2*h*0.4);
	let sy = Math.floor((h-h_b)/2);
	let sx = Math.floor((w-w_b)/2);
	canvas.width = w_b;
    canvas.height = h_b;
    const camera_div = document.getElementById("camera_div");
    const button_div = document.getElementById("button_div");
    camera_div.remove();
    button_div.remove();

	
    context.drawImage(video, sx, sy, w_b, h_b,0,0,w_b,h_b);	
    
    // insert yes or no buttons with listeners
    let new_div = document.createElement("div");
    new_div.style.textAlign = "center";
    new_div.style.margin = "auto";
    let yes = document.createElement("button");
    yes.innerHTML = "Accept";
    yes.addEventListener("click", () => {});
	let no = document.createElement("button");
	no.innerHTML = "Reject";
	no.addEventListener("click", () => {location.reload();});
	new_div.appendChild(yes);
    new_div.appendChild(no);
    document.body.appendChild(new_div);

    //const data = canvas.toDataURL("image/png");
    //photo.setAttribute("src", data);
  } else {
    clearphoto();
  }
}
  
  

</script>
